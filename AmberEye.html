<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>琥珀眼产品授权价格评估计算器</title>
		<noscript>琥珀眼产品授权价格评估计算器需要浏览器支持Javascript才能正常工作</noscript>
		<style>
							
			*{
				margin-bottom: 8px;
			}
						
			label {
				margin-right: 10px;
			}
			
			select {
				width: 165px;
				height: 23px;
			}
			
			#container {
				padding: 10px;
			}
			
			.desc {
			
				font-style: italic;
   			    font-size: 13px;
    			color: gray;
			}
			
			.splitter {
				margin-top: 20px;
				border-bottom: 1px gray solid;
				width: 600px;
				height: 4px;
			}
				
		</style>
	</head>
	<body>
		<div id="container">
			<h1>琥珀眼产品授权价格评估计算器</h1>
			<br>
			
			<label>套餐选择</label>
			<label><input name="s-package" type="radio" value="corp" selected />集团公司版</label>
			<label><input name="s-package" type="radio" value="enterprise" />大企业版</label> 
			<label><input name="s-package" type="radio" value="custom" />定制版本</label> 
			<br><br>
			
			<div id="detail">
				<!-- -->
				<label>开发语言</label>
				<label><input name="s-language" type="checkbox" value="0" />Java</label>
				<label><input name="s-language" type="checkbox" value="1" />Android</label>
				<label><input name="s-language" type="checkbox" value="2" />C/C++</label>
				<label><input name="s-language" type="checkbox" value="3" />C#</label>
				<label><input name="s-language" type="checkbox" value="4" />VB.NET</label>
				<label><input name="s-language" type="checkbox" value="5" />PHP</label>
				<label><input name="s-language" type="checkbox" value="6" />Scala</label>
				
				<br><br>
				
				<label>引擎个数</label>
				<select id="s-engine">
					<option value="1">1</option>
					<option value="1.25">2</option>
					<option value="1.5">3</option>
					<option value="2">5</option>
					<option value="2.5">10</option>
					<option value="3">15</option>
				</select>
				
				<br>
				
				<label>代码规模</label>
				<select id="s-code">
					<option value="1">&lt;=100万行</option>
					<option value="2">&lt;=200万行</option>
					<option value="4">&lt;=500万行</option>
					<option value="8">&lt;=1000万行</option>
					<option value="10">不限行数</option>
				</select>
				
				<br>
				
				<label>授权时长</label>
				<select id="s-duration">
					<option value="0.03">1周</option>
					<option value="0.1">1月</option>
					<option value="1">1年</option>
					<option value="1.5">3年</option>
					<option value="2">不限期</option>
				</select>
				
				<br><br>
				
			</div>
			<label>增值服务</label>
			<input id="s-service" value=0>人天
			<br>
			<span class="desc">如琥珀眼定制开发、安全规则定制、报告解读、安全修复咨询等</span>
			<br>
			
			<div class="splitter"></div>
			
			<label>价格:</label><span id="d-price"></span>
			<br>
			<p class="desc">含免费现场技术支持<span id="d-freesupport"></span>人天</p>
			
		</div>
		
<script src="jquery-3.4.1.min.js"></script>
<script>

$(function(){
	
	$("input[name=s-package]").change(function(event) {
		
		var val = $(event.target).val();

		
		if (val == "corp") {
			
			$("input[name=s-language]").prop('checked', true);
			$("#s-engine")[0].options[3].selected = true;
			$("#s-code")[0].options[4].selected = true;
			$("#s-duration")[0].options[4].selected = true;
			
			calculate();
			
		} else if (val == "enterprise") {
			
			$("input[name=s-language]").prop('checked', true);
			$("#s-engine")[0].options[0].selected = true;
			$("#s-code")[0].options[4].selected = true;
			$("#s-duration")[0].options[3].selected = true;
			
			calculate();
			
		} else { // custom
			
			var languages = $("input[name=s-language]")
			languages.prop('checked', false);
		
			languages[0].checked = true;
			languages[1].checked = true;
			languages[2].checked = true;
			
			calculate();
			
		}
		
	});

	$("select", $("#detail")).change(function(){
		
		$("input[type='radio'][name='s-package'][value='custom']").prop("checked","checked");
		calculate();
		
	});
	
	$("input", $("#detail")).change(function(){
		
		$("input[type='radio'][name='s-package'][value='custom']").prop("checked","checked");
		calculate();
		
	});
	
	$("#s-service").keyup(function(){
		
		console.debug($("#s-service").val());
		calculate();
		
	});

	BOTTOM_PRICE = 10000;
	calculate = function() {
		// service
		var PATTERN = /^\d+$/
		service = $("#s-service").val();
		  
	    if(service != "" && !PATTERN.test(service) ){
	    	alert("增值服务的人天数必须是正整数")
	        return;
	    }
		if (service == "") {
			service = 0;
		}
		
		
		lang_matrix = [0, 1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7];
		langCount = 0;
		$("input[name=s-language]").each(function(idx, lang){
			if (lang.checked) {
				langCount++;
			}
		})
		
		if(langCount <= 0) {
			alert("至少需要选择一种开发语言")
			return;
		}
		
		lang = lang_matrix[langCount];
		engine = $("#s-engine").val();
		code = $("#s-code").val();
		duration = $("#s-duration").val();
		
		product_price = 40000 * lang * engine * code * duration;
		if (product_price < BOTTOM_PRICE) {
			product_price = BOTTOM_PRICE;
		}
		
		extra_price = service * 4000;
		total_price = product_price + extra_price;
		
		$("#d-price").text(total_price + "元人民币");
		
		freeSupport = product_price / 50000;
		if (freeSupport < 1) {
			freeSupport = 0;
		} else {
			freeSupport = Math.ceil(freeSupport); 
		}
		$("#d-freesupport").text(freeSupport);
		
		console.info("40000 * lang * engine * code * duration + service * 4000 \n" + "40000*" + lang + "*" + engine + "*" + code + "*" + duration + "+" + service + "*" + 4000 );
	};
	
		
	// initialize
	$("input[name=s-package]").first().prop("checked", true).trigger("change");
	
});
</script>

	</body>
</html>